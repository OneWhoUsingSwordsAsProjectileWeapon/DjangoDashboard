{% load listing_extras %}

<div class="pricing-container" style="font-family: 'Helvetica Neue', Arial, sans-serif; color: #333; padding: 16px; border-radius: 8px; background-color: #f8f9fa; border: 1px solid #e0e0e0; min-height: 200px;">
    {% if start_date and end_date and nights %}
        <!-- Отображение для выбранных дат -->
        <div class="price-line" style="display: flex !important; justify-content: space-between !important; padding: 8px 0 !important; border-bottom: 1px solid #eee !important;">
            <span style="font-weight: 500; color: #333;">{{ listing.price_per_night|currency }} × {{ nights }} ночь{{ nights|pluralize:"ь,и,ей" }}</span>
            <span class="price-value" style="font-weight: 600 !important; color: #3498db !important;">{{ subtotal|currency }}</span>
        </div>
        
        {% if listing.cleaning_fee %}
        <div class="price-line" style="display: flex !important; justify-content: space-between !important; padding: 8px 0 !important; border-bottom: 1px solid #eee !important;">
            <span style="font-weight: 500; color: #333;">Плата за уборку</span>
            <span class="price-value" style="font-weight: 600 !important; color: #3498db !important;">{{ listing.cleaning_fee|currency }}</span>
        </div>
        {% endif %}
        
        {% if listing.service_fee %}
        <div class="price-line" style="display: flex !important; justify-content: space-between !important; padding: 8px 0 !important; border-bottom: 1px solid #eee !important;">
            <span style="font-weight: 500; color: #333;">Сервисный сбор</span>
            <span class="price-value" style="font-weight: 600 !important; color: #3498db !important;">{{ listing.service_fee|currency }}</span>
        </div>
        {% endif %}
        
        <div class="price-line price-total" style="display: flex !important; justify-content: space-between !important; font-weight: bold !important; margin-top: 12px !important; padding-top: 12px !important; border-top: 2px solid #ddd !important; font-size: 1.1em !important;">
            <span style="font-weight: 700 !important; color: #333;">Итого</span>
            <span class="price-value" style="font-weight: 700 !important; color: #e74c3c !important; font-size: 1.2em;">{{ total_price|currency }}</span>
        </div>

        <div class="price-notice notice-success" style="padding: 8px 12px !important; border-radius: 4px !important; font-size: 14px !important; margin-top: 16px !important; background-color: #d4edda !important; color: #155724 !important; border: 1px solid #c3e6cb !important;">
            <span class="price-icon" style="margin-right: 5px !important;">✓</span>
            Отличный выбор! Недвижимость доступна на выбранные даты.
        </div>
    {% else %}
        <!-- Отображение по умолчанию -->
        <div class="price-line" style="display: flex !important; justify-content: space-between !important; padding: 8px 0 !important; border-bottom: 1px solid #eee !important;">
            <span style="font-weight: 500; color: #333;">{{ listing.price_per_night|currency }} × 0 ночей</span>
            <span class="price-value" style="font-weight: 600 !important; color: #3498db !important;">₽0.00</span>
        </div>
        
        {% if listing.cleaning_fee %}
        <div class="price-line" style="display: flex !important; justify-content: space-between !important; padding: 8px 0 !important; border-bottom: 1px solid #eee !important;">
            <span style="font-weight: 500; color: #333;">Плата за уборку</span>
            <span class="price-value" style="font-weight: 600 !important; color: #3498db !important;">{{ listing.cleaning_fee|currency }}</span>
        </div>
        {% endif %}
        
        {% if listing.service_fee %}
        <div class="price-line" style="display: flex !important; justify-content: space-between !important; padding: 8px 0 !important; border-bottom: 1px solid #eee !important;">
            <span style="font-weight: 500; color: #333;">Сервисный сбор</span>
            <span class="price-value" style="font-weight: 600 !important; color: #3498db !important;">{{ listing.service_fee|currency }}</span>
        </div>
        {% endif %}
        
        <div class="price-line price-total" style="display: flex !important; justify-content: space-between !important; font-weight: bold !important; margin-top: 12px !important; padding-top: 12px !important; border-top: 2px solid #ddd !important; font-size: 1.1em !important;">
            <span style="font-weight: 700 !important; color: #333;">Итого</span>
            <span class="price-value" style="font-weight: 700 !important; color: #e74c3c !important; font-size: 1.2em;">{{ listing.cleaning_fee|add:listing.service_fee|currency }}</span>
        </div>

        <div class="price-notice notice-info" style="padding: 8px 12px !important; border-radius: 4px !important; font-size: 14px !important; margin-top: 16px !important; background-color: #d1ecf1 !important; color: #0c5460 !important; border: 1px solid #bee5eb !important;">
            <span class="price-icon" style="margin-right: 5px !important;">ℹ</span>
            Выберите даты, чтобы увидеть точную стоимость.
        </div>
    {% endif %} if check_in and check_out %}
        <!-- Рассчитанные цены -->
        <div class="price-line">
            <span>
                {{ nights }} ноч{{ nights|pluralize:"ь,и,ей" }} по {{ base_price_per_night|currency }}
            </span>
            <span class="price-value">{{ base_price|currency }}</span>
        </div>
        
        <div class="price-line">
            <span>Плата за уборку</span>
            <span class="price-value">{{ cleaning_fee|currency }}</span>
        </div>
        
        <div class="price-line">
            <span>Сервисный сбор</span>
            <span class="price-value">{{ service_fee|currency }}</span>
        </div>
        
        <div class="price-line price-total">
            <span>Итого</span>
            <span class="price-value">{{ total_price|currency }}</span>
        </div>
        
        {% if is_available %}
            <div class="price-notice notice-success">
                <i class="fas fa-check-circle price-icon"></i> Эти даты доступны!
            </div>
        {% else %}
            <div class="price-notice notice-error">
                <i class="fas fa-exclamation-circle price-icon"></i> Некоторые или все эти даты недоступны.
            </div>
        {% endif %}
    {% else %}
        <!-- Цены по умолчанию -->
        <div class="price-line">
            <span>{{ listing.price_per_night|currency }} × 0 ночей</span>
            <span>₽0.00</span>
        </div>
        
        <div class="price-line">
            <span>Плата за уборку</span>
            <span>{{ listing.cleaning_fee|currency }}</span>
        </div>
        
        <div class="price-line">
            <span>Сервисный сбор</span>
            <span>{{ listing.service_fee|currency }}</span>
        </div>
        
        <div class="price-line price-total">
            <span>Итого</span>
            <span>{{ listing.cleaning_fee|add:listing.service_fee|currency }}</span>
        </div>
        
        <div class="price-notice notice-info">
            <i class="fas fa-info-circle price-icon"></i> Выберите даты, чтобы увидеть общую стоимость.
        </div>
    {% endif %}
</div>